browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
p <- gseaplot2(kegg_gsea_object, geneSetID =1:6)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=12, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=12, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=15, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=18, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
p <- gseaplot2(kegg_gsea_object, geneSetID =1:10)
p
ggsave("../R_results/GSEA_output/GO_GSEA_differences.pdf", plot=p, width=15, height=18, units="cm")
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=18, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
p <- gseaplot2(kegg_gsea_object, geneSetID =1:10)
p
ggsave("../R_results/GSEA_output/GO_GSEA_differences.pdf", plot=p, width=15, height=22, units="cm")
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=18, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
p <- gseaplot2(kegg_gsea_object, geneSetID =1:10)
p
p <- gseaplot2(go_gsea_object, geneSetID =1:10)
p
ggsave("../R_results/GSEA_output/GO_GSEA_differences.pdf", plot=p, width=15, height=25, units="cm")
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=18, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
df_difference <- unique(subset(DESeq_result_table, DESeq_result_table$time==8 & !is.na(DESeq_result_table$locus))[,c("condition", "wmean_fitness", "locus")])
df_difference_wide <- pivot_wider(df_difference, names_from=condition, values_from=wmean_fitness)
df_difference_wide$difference <- df_difference_wide$BG11_Control - df_difference_wide$BG11_Lys
geneList <- df_difference_wide$difference
names(geneList) <- df_difference_wide$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,1:10])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_difference_control_Lys.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,1:10])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_difference_control_Lys.csv")
p <- gseaplot2(go_gsea_object, geneSetID =1:10)
p
ggsave("../R_results/GSEA_output/GO_GSEA_differences.pdf", plot=p, width=15, height=25, units="cm")
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=18, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
### code functional enrichment function
# read in term_to_gene and term_to_name for enricher()
term_to_gene <- read.table("../input/2024-01-18_GOterms_slrIdentifier.tsv", sep="\t", header=T)
term_to_gene <- term_to_gene[,c(2,1)]
names(term_to_gene) <- c("GO_ID", "locus_tag")
term_to_name <- read.delim("../input/term_to_name.csv", sep="\t", header=T)
browseKEGGNew_3 <- function (x, pathID, cluster_number)
{
url <- paste0("http://www.kegg.jp/kegg-bin/show_pathway?",
pathID, "/", x[cluster_number][11])
browseURL(url)
invisible(url)
}
df_difference <- unique(subset(DESeq_result_table, DESeq_result_table$time==8 & !is.na(DESeq_result_table$locus))[,c("condition", "wmean_fitness", "locus")])
df_difference_wide <- pivot_wider(df_difference, names_from=condition, values_from=wmean_fitness)
df_difference_wide$difference <- df_difference_wide$BG11_Control - df_difference_wide$BG11_Lys
geneList <- df_difference_wide$difference
names(geneList) <- df_difference_wide$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
p <- gseaplot2(go_gsea_object, geneSetID =1:10)
p
ggsave("../R_results/GSEA_output/GO_GSEA_differences.pdf", plot=p, width=15, height=25, units="cm")
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=18, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
### code functional enrichment function
# read in term_to_gene and term_to_name for enricher()
term_to_gene <- read.table("../input/2024-01-18_GOterms_slrIdentifier.tsv", sep="\t", header=T)
term_to_gene <- term_to_gene[,c(2,1)]
names(term_to_gene) <- c("GO_ID", "locus_tag")
term_to_name <- read.delim("../input/term_to_name.csv", sep="\t", header=T)
browseKEGGNew_3 <- function (x, pathID, cluster_number)
{
url <- paste0("http://www.kegg.jp/kegg-bin/show_pathway?",
pathID, "/", x[cluster_number][11])
browseURL(url)
invisible(url)
}
tail(term_to_name
)
### code functional enrichment function
# read in term_to_gene and term_to_name for enricher()
term_to_gene <- read.table("../input/2024-01-18_GOterms_slrIdentifier.tsv", sep="\t", header=T)
term_to_gene <- term_to_gene[,c(2,1)]
names(term_to_gene) <- c("GO_ID", "locus_tag")
term_to_name <- read.delim("../input/term_to_name.csv", sep=",", header=T)
browseKEGGNew_3 <- function (x, pathID, cluster_number)
{
url <- paste0("http://www.kegg.jp/kegg-bin/show_pathway?",
pathID, "/", x[cluster_number][11])
browseURL(url)
invisible(url)
}
tail(term_to_name)
### code functional enrichment function
# read in term_to_gene and term_to_name for enricher()
term_to_gene <- read.table("../input/2024-01-18_GOterms_slrIdentifier.tsv", sep="\t", header=T)
term_to_gene <- term_to_gene[,c(2,1)]
names(term_to_gene) <- c("GO_ID", "locus_tag")
term_to_name <- read.delim("../input/term_to_name.csv", sep=",", header=T)
browseKEGGNew_3 <- function (x, pathID, cluster_number)
{
url <- paste0("http://www.kegg.jp/kegg-bin/show_pathway?",
pathID, "/", x[cluster_number][11])
browseURL(url)
invisible(url)
}
tail(term_to_name)
### code functional enrichment function
# read in term_to_gene and term_to_name for enricher()
term_to_gene <- read.table("../input/2024-01-18_GOterms_slrIdentifier.tsv", sep="\t", header=T)
term_to_gene <- term_to_gene[,c(2,1)]
names(term_to_gene) <- c("GO_ID", "locus_tag")
term_to_name <- read.delim("../input/term_to_name.csv", sep="\t", header=T)
browseKEGGNew_3 <- function (x, pathID, cluster_number)
{
url <- paste0("http://www.kegg.jp/kegg-bin/show_pathway?",
pathID, "/", x[cluster_number][11])
browseURL(url)
invisible(url)
}
tail(term_to_name)
df_difference <- unique(subset(DESeq_result_table, DESeq_result_table$time==8 & !is.na(DESeq_result_table$locus))[,c("condition", "wmean_fitness", "locus")])
df_difference_wide <- pivot_wider(df_difference, names_from=condition, values_from=wmean_fitness)
df_difference_wide$difference <- df_difference_wide$BG11_Control - df_difference_wide$BG11_Lys
geneList <- df_difference_wide$difference
names(geneList) <- df_difference_wide$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,1:10])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_difference_control_Lys.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,1:10])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_difference_control_Lys.csv")
p <- gseaplot2(go_gsea_object, geneSetID =1:10)
p
ggsave("../R_results/GSEA_output/GO_GSEA_differences.pdf", plot=p, width=15, height=25, units="cm")
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=18, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
p <- gseaplot2(go_gsea_object, geneSetID =1:10)
p
ggsave("../R_results/GSEA_output/GO_GSEA_differences.pdf", plot=p, width=20, height=30, units="cm")
p <- gseaplot2(kegg_gsea_object, geneSetID =1:7)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences.pdf", plot=p, width=15, height=18, units="cm")
# browseKEGGNew_3(kegg_gsea_object, "syn03010", 1)
# browseKEGGNew_3(kegg_gsea_object, "syn01240", 2)
# browseKEGGNew_3(kegg_gsea_object, "syn01110", 3)
# browseKEGGNew_3(kegg_gsea_object, "syn00970", 4)
# browseKEGGNew_3(kegg_gsea_object, "syn01210", 5)
# browseKEGGNew_3(kegg_gsea_object, "syn00290", 6)
DESeq_result_table_control <- subset(DESeq_result_table, DESeq_result_table$condition=="BG11_Control" & DESeq_result_table$time==8)
geneList <- DESeq_result_table_control$wmean_fitness
names(geneList) <- DESeq_result_table_control$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,1:10])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_CRISPRi_control.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,1:10])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_CRISPRi_control.csv")
DESeq_result_table_Lys <- subset(DESeq_result_table, DESeq_result_table$condition=="BG11_Lys" & DESeq_result_table$time==8)
geneList <- DESeq_result_table_Lys$wmean_fitness
names(geneList) <- DESeq_result_table_Lys$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,1:10])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_CRISPRi_Lys.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,1:10])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_CRISPRi_Lys.csv")
geneList
DESeq_result_table_Lys <- subset(DESeq_result_table, DESeq_result_table$condition=="BG11_Lys" & DESeq_result_table$time==8)
geneList <- DESeq_result_table_Lys$wmean_fitness
names(geneList) <- DESeq_result_table_Lys$locus
geneList <- unique(geneList)
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
geneList
DESeq_result_table_Lys <- subset(DESeq_result_table, DESeq_result_table$condition=="BG11_Lys" & DESeq_result_table$time==8)[c("wmean_fitness", "locus")]
geneList <- DESeq_result_table_Lys$wmean_fitness
names(geneList) <- DESeq_result_table_Lys$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,1:10])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_CRISPRi_Lys.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,1:10])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_CRISPRi_Lys.csv")
DESeq_result_table_Lys
DESeq_result_table_Lys <- unique(subset(DESeq_result_table, DESeq_result_table$condition=="BG11_Lys" & DESeq_result_table$time==8)[c("wmean_fitness", "locus")]()
geneList <- DESeq_result_table_Lys$wmean_fitness
DESeq_result_table_Lys <- unique(subset(DESeq_result_table, DESeq_result_table$condition=="BG11_Lys" & DESeq_result_table$time==8)[c("wmean_fitness", "locus")])
geneList <- DESeq_result_table_Lys$wmean_fitness
names(geneList) <- DESeq_result_table_Lys$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,1:10])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_CRISPRi_Lys.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,1:10])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_CRISPRi_Lys.csv")
DESeq_result_table_control <- unique(subset(DESeq_result_table, DESeq_result_table$condition=="BG11_Control" & DESeq_result_table$time==8)[c("wmean_fitness", "locus")])
geneList <- DESeq_result_table_control$wmean_fitness
names(geneList) <- DESeq_result_table_control$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,1:10])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_CRISPRi_control.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,1:10])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_CRISPRi_control.csv")
require("knitr")
library(ggplot2)
library(ggrepel)
library(ggpubr)
library(tidyverse)
library(magrittr)
library(clusterProfiler)
library(enrichplot)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
load("../results/fitness/result.Rdata")
plot_controls_sgRNAs <- DESeq_result_table %>% filter(grepl("ctrl", sgRNA_target)) %>%
ggplot(aes(x = time, y = log2FoldChange, color = sgRNA_target)) +
geom_line(linewidth = 1) + geom_point(size = 2) + ylim(-5, 5) + facet_wrap(~ condition, ncol = 4)
print(plot_controls_sgRNAs)
ggsave("../R_results/plot_control_sgRNAs.pdf", plot=plot_controls_sgRNAs, width=12, height=12, units="cm")
mapping_gene_locus <- read_tsv("../input/2023-02-24_mapping_trivial_names.tsv", show_col_types=FALSE)
names(mapping_gene_locus) <- c("sgRNA_target", "locus")
DESeq_result_table <- DESeq_result_table %>% left_join(mapping_gene_locus)
annotation <- read_tsv("../input/annotation_locusTags_stand13012021.csv", show_col_types = FALSE)
annotation_2 <- annotation[,c(1,2,3)]
names(annotation_2) <- c("locus", "Gene name","Product")
DESeq_result_table <- DESeq_result_table %>% left_join(annotation_2)
write_tsv(DESeq_result_table, file="../R_results/annotated_DESeq_result_table.tsv")
df_reduced_info <- unique(subset(DESeq_result_table, DESeq_result_table$time==8 | DESeq_result_table$time==14)[,c(2,25,26,27,4,20,21,23,24)])
write_tsv(df_reduced_info, file="../R_results/Reduced_annotated_DESeq_result_table.tsv")
df_red_wide <- pivot_wider(df_reduced_info, names_from=condition, values_from=c(wmean_fitness, sd_fitness, p_fitness_adj, comb_score))
write_tsv(df_red_wide, file="../R_results/Wide_DESeq_result_table.tsv")
df_reduced <- unique(subset(DESeq_result_table, DESeq_result_table$time==8)[,c(2,4,20)])
df_red_ncRNAs <- subset(df_reduced, grepl("nc_", df_reduced$sgRNA_target))
df_red_no_ncRNAs <- subset(df_reduced, !grepl("nc_", df_reduced$sgRNA_target))
df_red_wide <- pivot_wider(df_red_no_ncRNAs,names_from="condition", values_from=c("wmean_fitness"))
plot_fitness_fitness <- function(df_input, y_axis, y_axis_label, x_axis="CO2_4percent", x_axis_label="Weighted mean fitness 4% CO2", filename_save="../R_results/wfitnes_plot.pdf"){
df_input$diff <- "NO"
df_input$diff[(df_input[[x_axis]] - df_input[[y_axis]] > 2.5) | (df_input[[x_axis]] - df_input[[y_axis]] < (-2.5))] <- "YES"
# prepare labels for plot
df_input$delabel <- NA
df_input$delabel[df_input$diff !="NO"] <- df_input$sgRNA_target[df_input$diff != "NO"]
mycolors <- c("darkblue",  "#d3d3d3b2")
names(mycolors) <- c("YES", "NO")
p <- ggplot(data=df_input, aes(x=eval(parse(text=x_axis)), y=eval(parse(text=y_axis)), label=delabel,col=diff)) + geom_point(alpha=0.5, show.legend = FALSE) +
theme_light() + labs(y=y_axis_label, x=x_axis_label) + theme(legend.position = "none") + geom_abline(intercept=0,slope=1,linetype="dashed",color="black") + geom_abline(intercept=-2.5, slope=1, linetype="dashed", color="black") + geom_abline(intercept=2.5, slope=1, linetype="dashed", color="black") + scale_colour_manual(values = mycolors) + geom_text_repel(fontface="italic") #+ xlim(-6, +7) +ylim(-6,+7)
ggsave(filename = filename_save, plot=p, width=12, height=12, units="cm")
return(p)
}
plot_fitness_fitness(df_red_wide, "CO2_30percent", y_axis_label="Weighted mean fitness 30% CO2", filename_save = "../R_results/wfitness.pdf")
df_red_wide_ncRNA <- pivot_wider(df_red_ncRNAs,names_from="condition", values_from=c("wmean_fitness"))
plot_fitness_fitness(df_red_wide_ncRNA, "CO2_30percent", y_axis_label="Weighted mean fitness 30% CO2", filename_save = "../R_results/ncRNA_wfitness.pdf")
### code functional enrichment function
# read in term_to_gene and term_to_name for enricher()
term_to_gene <- read.table("../input/2024-01-18_GOterms_slrIdentifier.tsv", sep="\t", header=T)
term_to_gene <- term_to_gene[,c(2,1)]
names(term_to_gene) <- c("GO_ID", "locus_tag")
term_to_name <- read.delim("../input/term_to_name.csv", sep="\t", header=T)
columns_to_show  <- c(2,3,4,5,7,8)
columns_to_show_KEGG <- c(1,2,3,4,7)
DESeq_result_table_4percent <- unique(subset(DESeq_result_table, DESeq_result_table$condition=="CO2_4percent" & DESeq_result_table$time==8)[c("wmean_fitness", "locus")])
geneList <- DESeq_result_table_4percent$wmean_fitness
names(geneList) <- DESeq_result_table_4percent$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,columns_to_show])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_CRISPRi_4percent.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,columns_to_show_KEGG])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_CRISPRi_4percent.csv")
DESeq_result_table_30percent <- subset(DESeq_result_table, DESeq_result_table$condition=="CO2_4percent" & DESeq_result_table$time==10)
geneList <- DESeq_result_table_30percent$fitness
names(geneList) <- DESeq_result_table_30percent$locus
geneList = sort(geneList, decreasing = TRUE)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,1:10])
DESeq_result_table_30percent <- unique(subset(DESeq_result_table, DESeq_result_table$condition=="CO2_30percent" & DESeq_result_table$time==8)[c("wmean_fitness", "locus")])
geneList <- DESeq_result_table_30percent$wmean_fitness
names(geneList) <- DESeq_result_table_30percent$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,columns_to_show])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_CRISPRi_30percent.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,columns_to_show_KEGG])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_CRISPRi_30percent.csv")
df_difference <- unique(subset(DESeq_result_table, DESeq_result_table$time==8 & !is.na(DESeq_result_table$locus))[,c("condition", "wmean_fitness", "locus")])
df_difference_wide <- pivot_wider(df_difference, names_from=condition, values_from=wmean_fitness)
df_difference_wide$difference <- df_difference_wide$CO2_4percent - df_difference_wide$CO2_30percent
geneList <- df_difference_wide$difference
names(geneList) <- df_difference_wide$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,columns_to_show])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_difference.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,columns_to_show_KEGG])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_difference.csv")
p <- gseaplot2(go_gsea_object, geneSetID =1:8)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences_part1.pdf", plot=p, width=15, height=18, units="cm")
p <- gseaplot2(kegg_gsea_object, geneSetID =9:16)
p <- gseaplot2(go_gsea_object, geneSetID =1:8)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences_part1.pdf", plot=p, width=20, height=25, units="cm")
p <- gseaplot2(kegg_gsea_object, geneSetID =9:15)
p
ggsave("../R_results/GSEA_output/KEGG_GSEA_differences_part2.pdf", plot=p, width=20, height=25, units="cm")
require("knitr")
library(ggplot2)
library(ggrepel)
library(ggpubr)
library(tidyverse)
library(magrittr)
library(clusterProfiler)
library(enrichplot)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
load("../results/fitness/result.Rdata")
plot_controls_sgRNAs <- DESeq_result_table %>% filter(grepl("ctrl", sgRNA_target)) %>%
ggplot(aes(x = time, y = log2FoldChange, color = sgRNA_target)) +
geom_line(linewidth = 1) + geom_point(size = 2) + ylim(-5, 5) + facet_wrap(~ condition, ncol = 4)
print(plot_controls_sgRNAs)
ggsave("../R_results/plot_control_sgRNAs.pdf", plot=plot_controls_sgRNAs, width=12, height=12, units="cm")
mapping_gene_locus <- read_tsv("../input/2023-02-24_mapping_trivial_names.tsv", show_col_types=FALSE)
names(mapping_gene_locus) <- c("sgRNA_target", "locus")
DESeq_result_table <- DESeq_result_table %>% left_join(mapping_gene_locus)
annotation <- read_tsv("../input/annotation_locusTags_stand13012021.csv", show_col_types = FALSE)
annotation_2 <- annotation[,c(1,2,3)]
names(annotation_2) <- c("locus", "Gene name","Product")
DESeq_result_table <- DESeq_result_table %>% left_join(annotation_2)
write_tsv(DESeq_result_table, file="../R_results/annotated_DESeq_result_table.tsv")
df_reduced_info <- unique(subset(DESeq_result_table, DESeq_result_table$time==8 | DESeq_result_table$time==14)[,c(2,25,26,27,4,20,21,23,24)])
write_tsv(df_reduced_info, file="../R_results/Reduced_annotated_DESeq_result_table.tsv")
df_red_wide <- pivot_wider(df_reduced_info, names_from=condition, values_from=c(wmean_fitness, sd_fitness, p_fitness_adj, comb_score))
write_tsv(df_red_wide, file="../R_results/Wide_DESeq_result_table.tsv")
df_reduced <- unique(subset(DESeq_result_table, DESeq_result_table$time==8)[,c(2,4,20)])
df_red_ncRNAs <- subset(df_reduced, grepl("nc_", df_reduced$sgRNA_target))
df_red_no_ncRNAs <- subset(df_reduced, !grepl("nc_", df_reduced$sgRNA_target))
df_red_wide <- pivot_wider(df_red_no_ncRNAs,names_from="condition", values_from=c("wmean_fitness"))
plot_fitness_fitness <- function(df_input, y_axis, y_axis_label, x_axis="CO2_4percent", x_axis_label="Weighted mean fitness 4% CO2", filename_save="../R_results/wfitnes_plot.pdf"){
df_input$diff <- "NO"
df_input$diff[(df_input[[x_axis]] - df_input[[y_axis]] > 2.5) | (df_input[[x_axis]] - df_input[[y_axis]] < (-2.5))] <- "YES"
# prepare labels for plot
df_input$delabel <- NA
df_input$delabel[df_input$diff !="NO"] <- df_input$sgRNA_target[df_input$diff != "NO"]
mycolors <- c("darkblue",  "#d3d3d3b2")
names(mycolors) <- c("YES", "NO")
p <- ggplot(data=df_input, aes(x=eval(parse(text=x_axis)), y=eval(parse(text=y_axis)), label=delabel,col=diff)) + geom_point(alpha=0.5, show.legend = FALSE) +
theme_light() + labs(y=y_axis_label, x=x_axis_label) + theme(legend.position = "none") + geom_abline(intercept=0,slope=1,linetype="dashed",color="black") + geom_abline(intercept=-2.5, slope=1, linetype="dashed", color="black") + geom_abline(intercept=2.5, slope=1, linetype="dashed", color="black") + scale_colour_manual(values = mycolors) + geom_text_repel(fontface="italic") #+ xlim(-6, +7) +ylim(-6,+7)
ggsave(filename = filename_save, plot=p, width=12, height=12, units="cm")
return(p)
}
plot_fitness_fitness(df_red_wide, "CO2_30percent", y_axis_label="Weighted mean fitness 30% CO2", filename_save = "../R_results/wfitness.pdf")
df_red_wide_ncRNA <- pivot_wider(df_red_ncRNAs,names_from="condition", values_from=c("wmean_fitness"))
plot_fitness_fitness(df_red_wide_ncRNA, "CO2_30percent", y_axis_label="Weighted mean fitness 30% CO2", filename_save = "../R_results/ncRNA_wfitness.pdf")
### code functional enrichment function
# read in term_to_gene and term_to_name for enricher()
term_to_gene <- read.table("../input/2024-01-18_GOterms_slrIdentifier.tsv", sep="\t", header=T)
term_to_gene <- term_to_gene[,c(2,1)]
names(term_to_gene) <- c("GO_ID", "locus_tag")
term_to_name <- read.delim("../input/term_to_name.csv", sep="\t", header=T)
columns_to_show  <- c(2,3,4,5,7,8)
columns_to_show_KEGG <- c(1,2,3,4,7)
DESeq_result_table_4percent <- unique(subset(DESeq_result_table, DESeq_result_table$condition=="CO2_4percent" & DESeq_result_table$time==8)[c("wmean_fitness", "locus")])
geneList <- DESeq_result_table_4percent$wmean_fitness
names(geneList) <- DESeq_result_table_4percent$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,columns_to_show])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_CRISPRi_4percent.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,columns_to_show_KEGG])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_CRISPRi_4percent.csv")
DESeq_result_table_30percent <- subset(DESeq_result_table, DESeq_result_table$condition=="CO2_4percent" & DESeq_result_table$time==10)
geneList <- DESeq_result_table_30percent$fitness
names(geneList) <- DESeq_result_table_30percent$locus
geneList = sort(geneList, decreasing = TRUE)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,1:10])
DESeq_result_table_30percent <- unique(subset(DESeq_result_table, DESeq_result_table$condition=="CO2_30percent" & DESeq_result_table$time==8)[c("wmean_fitness", "locus")])
geneList <- DESeq_result_table_30percent$wmean_fitness
names(geneList) <- DESeq_result_table_30percent$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,columns_to_show])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_CRISPRi_30percent.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,columns_to_show_KEGG])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_CRISPRi_30percent.csv")
df_difference <- unique(subset(DESeq_result_table, DESeq_result_table$time==8 & !is.na(DESeq_result_table$locus))[,c("condition", "wmean_fitness", "locus")])
df_difference_wide <- pivot_wider(df_difference, names_from=condition, values_from=wmean_fitness)
df_difference_wide$difference <- df_difference_wide$CO2_4percent - df_difference_wide$CO2_30percent
geneList <- df_difference_wide$difference
names(geneList) <- df_difference_wide$locus
geneList = sort(geneList, decreasing = TRUE)
set.seed(513)
go_gsea_object <- GSEA(geneList, TERM2GENE = term_to_gene, TERM2NAME=term_to_name, seed=TRUE)
print(head(go_gsea_object)[,columns_to_show])
write.csv(go_gsea_object, "../R_results/GSEA_output/GO_GSEA_difference.csv")
set.seed(914)
kegg_gsea_object <- gseKEGG(geneList, organism="syn", minGSSize=10, pvalueCutoff = 0.05, seed=TRUE)
print(head(kegg_gsea_object)[,columns_to_show_KEGG])
write.csv(kegg_gsea_object, "../R_results/GSEA_output/KEGG_GSEA_difference.csv")
hist(df_difference_wide$CO2_30percent)
hist(df_difference_wide$CO2_4percent)
